<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Just for noting</title><link href="https://blog.m157q.tw/" rel="alternate"></link><link href="https://blog.m157q.tw/feeds/tag.foremost.atom.xml" rel="self"></link><id>https://blog.m157q.tw/</id><updated>2015-08-26T15:58:58+08:00</updated><entry><title>Data recovery by using foremost</title><link href="https://blog.m157q.tw/posts/2015/08/25/data-recovery-by-using-foremost/" rel="alternate"></link><published>2015-08-26T15:58:58+08:00</published><updated>2015-08-26T15:58:58+08:00</updated><author><name>m157q</name></author><id>tag:blog.m157q.tw,2015-08-25:posts/2015/08/25/data-recovery-by-using-foremost/</id><summary type="html">&lt;h3&gt;溫馨小提醒&lt;/h3&gt;
&lt;p&gt;要把所有 *.JPG 轉成 *.jpg 的情況下&lt;br /&gt;
如果有 &lt;code&gt;rename&lt;/code&gt; 的話，可以這樣用 &lt;code&gt;rename "s/JPG/jpg/" *.JPG&lt;/code&gt;&lt;br /&gt;
如果沒有的話，我是這樣用 &lt;code&gt;find | grep .JPG | xargs -I {}.JPG mv {}.JPG {}.jpg&lt;/code&gt;&lt;br /&gt;
然後就悲劇了，因為如果以 .JPG 結尾的檔案有空白或啥其他特殊的符號的話，就會出現恐怖的意外&lt;br /&gt;
所以改成 &lt;code&gt;find | grep .JPG | xargs -I {}.JPG mv "{}.JPG" "{}.jpg"&lt;/code&gt; 才能避免悲劇發生&lt;br /&gt;
(應該吧?有錯請指正)  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;其實可以省略 grep  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;find -type f -name "*.JPG" | xargs -I {}.JPG mv "{}.JPG" "{}.jpg"&lt;/code&gt;  &lt;/p&gt;
&lt;h3&gt;資料救援之路 with foremost&lt;/h3&gt;
&lt;p&gt;搜尋了一下相關資料&lt;br /&gt;
找到了 &lt;a href="https://wiki.archlinux.org/index.php/File_recovery"&gt;File recovery - ArchWiki&lt;/a&gt; 和 &lt;a href="https://help.ubuntu.com/community/DataRecovery"&gt;DataRecovery - Community Help Wiki&lt;/a&gt;&lt;br /&gt;
一開始是裝了 &lt;a href="http://extundelete.sourceforge.net/"&gt;extundelete&lt;/a&gt;&lt;br /&gt;
裝完以後才想到這顆外接硬碟是 NTFS 不是 ext4&lt;br /&gt;
所以看到底下的 &lt;a href="http://foremost.sourceforge.net/"&gt;Foremost&lt;/a&gt;&lt;br /&gt;
在 &lt;a href="https://help.ubuntu.com/community/DataRecovery"&gt;DataRecovery - Community Help Wiki&lt;/a&gt; 裡頭寫著支援 fat, ext3 和 NTFS&lt;br /&gt;
所以才想裝來試試看  &lt;/p&gt;
&lt;p&gt;Arch Linux Official Package 裡頭有&lt;br /&gt;
所以直接 &lt;code&gt;sudo pacman -S foremost&lt;/code&gt; 就能安裝了&lt;br /&gt;
使用方法也沒有很難  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;foremost version 1.5.7 by Jesse Kornblum, Kris Kendall, and Nick Mikus.  
$ foremost [-v|-V|-h|-T|-Q|-q|-a|-w-d] [-t &amp;lt;type&amp;gt;] [-s &amp;lt;blocks&amp;gt;] [-k &amp;lt;size&amp;gt;]  
    [-b &amp;lt;size&amp;gt;] [-c &amp;lt;file&amp;gt;] [-o &amp;lt;dir&amp;gt;] [-i &amp;lt;file]  

-V  - display copyright information and exit  
-t  - specify file type.  (-t jpeg,pdf ...)  
-d  - turn on indirect block detection (for UNIX file-systems)  
-i  - specify input file (default is stdin)  
-a  - Write all headers, perform no error detection (corrupted files)  
-w  - Only write the audit file, do not write any detected files to the disk  
-o  - set output directory (defaults to output)  
-c  - set configuration file to use (defaults to foremost.conf)  
-q  - enables quick mode. Search are performed on 512 byte boundaries.  
-Q  - enables quiet mode. Suppress output messages.  
-v  - verbose mode. Logs all messages to screen  
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;使用前先把外接硬碟 &lt;code&gt;umount&lt;/code&gt; 後&lt;br /&gt;
再 &lt;code&gt;foremost -t jpg -i /dev/sdb1 -o /recovery&lt;/code&gt;&lt;br /&gt;
這是我這次的使用情況: 把 sdb1 中的 .jpg 檔案還原到 /recovery 這個資料夾中&lt;br /&gt;
比較詳細一點的範例可以參考 &lt;a href="https://help.ubuntu.com/community/DataRecovery#Foremost"&gt;https://help.ubuntu.com/community/DataRecovery#Foremost&lt;/a&gt;  &lt;/p&gt;
&lt;p&gt;另外在 &lt;a href="https://wiki.archlinux.org/index.php/File_recovery#Foremost"&gt;https://wiki.archlinux.org/index.php/File_recovery#Foremost&lt;/a&gt; 也有寫到&lt;br /&gt;
&lt;code&gt;foremost&lt;/code&gt; 會根據檔案的 headers, footers 以及內部的資料結構來進行檔案的回復&lt;br /&gt;
可以裝在 Live USB 上使用當作救援USB，也可以直接安裝來使用&lt;br /&gt;
並且可以透過 config file (&lt;code&gt;/etc/foremost.conf&lt;/code&gt;)來決定要回復哪些類型的檔案&lt;br /&gt;
內建也有提供檔案類型可供選擇：&lt;br /&gt;
jpg, gif, png, bmp, avi, exe, mpg, wav, riff, wmv, mov, pdf, ole, doc, zip, rar, htm, cpp  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果沒有用 -t 指定檔案類型的話，預設就是回復所有檔案  &lt;/li&gt;
&lt;li&gt;-i 則是接要救援的東西(預設是 stdin，可以是單檔、磁區或是映像檔)  &lt;/li&gt;
&lt;li&gt;-o 就接要把復原的檔案放到哪裡  &lt;/li&gt;
&lt;li&gt;-v 的話可以把 log print 到 stdout  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;總之用法大概就是這樣&lt;br /&gt;
對了 要注意一下 -o 參數接的目標位置的容量夠不夠大，不夠大的話可能會悲劇(?)  &lt;/p&gt;
&lt;h3&gt;結果&lt;/h3&gt;
&lt;p&gt;程式大概執行了兩個半小時左右&lt;br /&gt;
總共回復了 24,481 個 jpg 檔&lt;br /&gt;
大小約 11G 左右&lt;br /&gt;
只有稍微看一下，但的確都是消失的檔案沒錯&lt;br /&gt;
之後應該就是慢慢將檔案重新分類就是  &lt;/p&gt;
&lt;h3&gt;結論&lt;/h3&gt;
&lt;p&gt;第一次自己搞檔案救援，還好沒把外接硬碟弄掛，不然我一定會哭死&lt;br /&gt;
畢竟這台外接硬碟也有點年紀了，大概也用了6年左右，很怕他哪天突然壞軌掛掉&lt;br /&gt;
然後 &lt;code&gt;extundelete&lt;/code&gt; 我還沒試過，只是剛好看到順便提一下&lt;br /&gt;
至於 &lt;code&gt;foremost&lt;/code&gt;，在 &lt;a href="https://github.com/korczis/foremost"&gt;https://github.com/korczis/foremost&lt;/a&gt; 有原始碼，&lt;br /&gt;
稍微瞄過了一下，覺得程式碼寫的蠻乾淨的，有空的時候想去理解一下裏面程式碼怎麼寫的&lt;br /&gt;
然後 README 裏面寫到  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Foremost was written by Special Agent Kris Kendall and Special Agent Jesse  
Kornblum of the United States Air Force Office of Special Investigations  
starting in March 2001.  
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;恩 沒錯 是美國空軍特別調查辦公室(AFOSI)的兩位特務(Special Agent)寫的&lt;br /&gt;
不愧是美國政府出品 真的蠻猛的 而且還是距今十幾年的 project&lt;br /&gt;
(真不知道我自己現在寫的這些程式 十多年後還能不能正常運作)&lt;br /&gt;
老實說我本來真的對回復這些檔案不抱任何期待&lt;br /&gt;
畢竟有點 UNIX-like system 使用經驗的人大概都知道 rm 跟 mv 不要亂下&lt;br /&gt;
下了就別抱太大的期待能救回來了，畢竟這不是丟到垃圾桶而已&lt;br /&gt;
但 foremost 真的幫我把圖片救回來了...&lt;br /&gt;
所以寫個文章紀錄一下這個好東西&lt;br /&gt;
(只是不知道 24,881 個圖片我要手動分類多久Orz)  &lt;/p&gt;
&lt;h3&gt;References&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/korczis/foremost"&gt;https://github.com/korczis/foremost&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://help.ubuntu.com/community/DataRecovery"&gt;https://help.ubuntu.com/community/DataRecovery&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/File_recovery"&gt;https://wiki.archlinux.org/index.php/File_recovery&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/Foremost"&gt;https://wiki.archlinux.org/index.php/Foremost&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="http://foremost.sourceforge.net/"&gt;http://foremost.sourceforge.net/&lt;/a&gt;  &lt;/li&gt;
&lt;/ul&gt;</summary><category term="Data Recovery"></category><category term="foremost"></category><category term="Life"></category></entry></feed>