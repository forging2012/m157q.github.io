<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>Just for noting</title><link>https://blog.m157q.tw/</link><description></description><lastBuildDate>Tue, 27 Oct 2015 19:08:00 +0800</lastBuildDate><item><title>Arch Linux Quick Installation with GPT in BIOS</title><link>https://blog.m157q.tw/posts/2013/12/30/arch-linux-quick-installation-with-gpt-in-bios/</link><description>&lt;h2&gt;Preface&lt;/h2&gt;
&lt;p&gt;A quick installation based on &lt;a href="https://wiki.archlinux.org/index.php/Beginners'_Guide"&gt;Arch wiki - Beginners' Guide&lt;/a&gt;  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;WITHOUT NETWORK CONFIGURATION&lt;br /&gt;
(INSTALL IN VIRTUAL MACHINE USING DHCP).&lt;br /&gt;
YOU NEED TO SETUP THE NETWORK OF THE MACHINE FIRST.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr /&gt;
&lt;h2&gt;Network&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://wiki.archlinux.org/index.php/Network_configuration"&gt;Network configuration - ArchWiki&lt;/a&gt;  &lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;Partition&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# lsblk&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;Check you are partitioning on the right disk.  &lt;/li&gt;
&lt;li&gt;(assume &lt;code&gt;/dev/sda&lt;/code&gt; here)  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;# cgdisk /dev/sda&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;Partition Table  &lt;ul&gt;
&lt;li&gt;GPT - &lt;code&gt;ef02&lt;/code&gt; (BIOS boot partition) =&amp;gt; &lt;code&gt;/dev/sda1&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;1M  &lt;/li&gt;
&lt;li&gt;MUST be the first partition of the disk.  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;IMPORTANT!! Set to BIOS Boot partition for grub2&lt;/code&gt;.  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;/ - 8300 (Linux filesystem) =&amp;gt; &lt;code&gt;/dev/sda2&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;swap - 8200 (Linux swap) =&amp;gt; &lt;code&gt;/dev/sda3&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;home - 8302 (Linux /home) =&amp;gt; &lt;code&gt;/dev/sda4&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Write -&amp;gt; yes  &lt;/li&gt;
&lt;li&gt;QUIT  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;# lsblk&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;Check if the partition scheme of the disk is right.  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2&gt;Create Filesystem&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# mkfs.ext4 /dev/sda2&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;&lt;code&gt;ext4&lt;/code&gt; for &lt;code&gt;/&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;# mkfs.ext4 /dev/sda4&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;&lt;code&gt;ext4&lt;/code&gt; for &lt;code&gt;home&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;# mkswap /dev/sda3 &amp;amp;&amp;amp; swapon /dev/sda3&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;&lt;code&gt;swap&lt;/code&gt; for &lt;code&gt;swap&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Mount partitionis&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# mount /dev/sda2 /mnt&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;# mkdir /mnt/home &amp;amp;&amp;amp; mount /dev/sda4 /mnt/home&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Select a mirror&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# vi /etc/pacman.d/mirrorlist&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;Choose a mirror site that is the nearest from your machine  &lt;/li&gt;
&lt;li&gt;Copy it to the top of this mirrorlist.  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Install the base system&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# pacstrap /mnt base base-devel&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Generate fstab&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# genfstab -p /mnt &amp;gt; /mnt/etc/fstab&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;# vi /mnt/etc/fstab&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;Check if the fstab is right.  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2&gt;Chroot and configure the base system&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# arch-chroot /mnt /bin/bash&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;After chroot, use bash.  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Locale &amp;amp; Keymap&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# vi /etc/locale.gen&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;Select needed encoding and uncomment them.  &lt;/li&gt;
&lt;li&gt;en_US.UTF-8 UTF-8  &lt;/li&gt;
&lt;li&gt;zh_TW.UTF-8 UTF-8  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;# locale-gen&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;# echo "LANG=en_US.UTF-8" &amp;gt; /etc/locale.conf&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;# echo "KEYMAP=us" &amp;gt; /etc/vconsole.conf&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Timezone &amp;amp; Hardclock &amp;amp; Hostname&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# ln -s /usr/share/zoneinfo/Asia/Taipei /etc/localtime&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;# hwclock --systohc --utc&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;# echo "$myhostname" &amp;gt; /etc/hostname&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Configure the network (DHCP)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# systemctl enable dhcpcd.service&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;I use DHCP for the virtual machine.  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;For static IP  and wireless, Check the Official Guide  &lt;ul&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/Network_configuration"&gt;Network configuration - ArchWiki&lt;/a&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Create an initial ramdisk environment&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;If you won't modify &lt;code&gt;/etc/mkinitcpio.conf&lt;/code&gt;, you can just skip this step.  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;# mkinitcpio -p linux&lt;/code&gt; after modified &lt;code&gt;/etc/mkinitcpio.conf&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Set User&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# passwd&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;set root password.  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;# useradd -m $user&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;add a user with home directory.  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;# passwd $user&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;set the password for the user.  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2&gt;Install and configure a bootloader&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# pacman -S grub&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;# vi /etc/default/grub&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;&lt;a href="https://bugs.archlinux.org/task/38041?project=1&amp;amp;cat%5B0%5D=31&amp;amp;string=grub"&gt;For a bug of grub I've met&lt;/a&gt;.  &lt;/li&gt;
&lt;li&gt;Add &lt;code&gt;GRUB_DISABLE_SUBMENU=y&lt;/code&gt; at the end of &lt;code&gt;/etc/default/grub&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;# grub-mkconfig -o /boot/grub/grub.cfg&lt;/code&gt;  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Generate the configuration file of grub  &lt;blockquote&gt;
&lt;p&gt;If you didn't add the &lt;code&gt;GRUB_DISABLE_SUBMENU=y&lt;/code&gt; mentioned above&lt;br /&gt;
you would get error message and fail here.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;# grub-install --target=i386-pc --recheck /dev/sda&lt;/code&gt;  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If you didn't mark the GPT partition (1007KiB)&lt;br /&gt;
as a &lt;code&gt;BIOS Boot Partition&lt;/code&gt;&lt;br /&gt;
you would get error message and fail here.&lt;br /&gt;
the solution is in &lt;a href="https://wiki.archlinux.org/index.php/GRUB#Intel_BIOS_not_booting_GPT"&gt;GRUB - ArchWiki&lt;/a&gt;  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2&gt;After installation&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;# exit&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;# umount -R /mnt&lt;/code&gt;  &lt;ul&gt;
&lt;li&gt;unmount the partitions  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;# reboot&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/Beginners'_Guide"&gt;Arch wiki - Beginner's Guide&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/GRUB#Intel_BIOS_not_booting_GPT"&gt;Arch wiki - GRUB - Intel BIOS not booting GPT&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://bbs.archlinux.org/viewtopic.php?id=173921"&gt;[solved] Grub Update gives Syntax error&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://bugs.archlinux.org/task/38041?project=1&amp;amp;cat%5B0%5D=31&amp;amp;string=grub"&gt;FS#38041 - grub 1:2.00.1282.g5ae5c54-1 will not generate grub.cfg file syntax errors&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="http://xatierlike.blogspot.tw/2012/10/archlinux-installation.html"&gt;Archlinux installation - xatierlike&lt;/a&gt;  &lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">m157q</dc:creator><pubDate>Tue, 27 Oct 2015 19:08:00 +0800</pubDate><guid isPermaLink="false">tag:blog.m157q.tw,2013-12-30:posts/2013/12/30/arch-linux-quick-installation-with-gpt-in-bios/</guid><category>Linux</category><category>Arch Linux</category><category>Guide</category><category>GPT</category><category>BIOS</category></item></channel></rss>