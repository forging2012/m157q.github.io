<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>Just for noting</title><link>https://blog.m157q.tw/</link><description></description><lastBuildDate>Sun, 07 Jan 2018 01:42:00 +0800</lastBuildDate><item><title>Python ä¸­è®“ urllib ä½¿ç”¨ cookie çš„æ–¹æ³•</title><link>https://blog.m157q.tw/posts/2018/01/06/use-cookie-with-urllib-in-python/</link><description>&lt;h2&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;å…¶å¯¦ä¸€èˆ¬ä¾†èªªåªè¦ç”¨ &lt;a href="https://github.com/requests/requests"&gt;&lt;code&gt;requests&lt;/code&gt;&lt;/a&gt; é€™å€‹è¶…å¼·çš„ third-party library å°±å¯ä»¥è§£äº†ï¼Œ&lt;code&gt;requests&lt;/code&gt; å·²ç¶“æŠŠ Cookie çš„éƒ¨ä»½è™•ç†å¥½äº†ï¼Œé‚£ç‚ºä»€éº¼è¦ç´€éŒ„é€™ç¯‡ï¼Ÿå…¶å¯¦é€™å•é¡Œä¹Ÿæ˜¯ç´„è«ä¸€å¹´å‰åœ¨å‰å…¬å¸å·¥ä½œæ™‚é‡åˆ°çš„å•é¡Œï¼Œä»¥ä¸‹èªªæ˜ä¸€ä¸‹ï¼š  &lt;/p&gt;
&lt;p&gt;Google App Engine Standard Environment é™¤äº†é è¨­ä½¿ç”¨ Python 2 ä»¥å¤–ï¼ŒåŠ ä¸Šå› ç‚ºæ˜¯ PaaS çš„é—œä¿‚ï¼Œåšäº†ä¸å°‘é™åˆ¶ï¼Œç›´æ¥æ‹¿ &lt;code&gt;requests&lt;/code&gt; ä¾†ç”¨çš„è©±æœƒç„¡æ³•ä½¿ç”¨ï¼Œå¿…é ˆå†æ­é… &lt;a href="https://github.com/requests/toolbelt"&gt;&lt;code&gt;requests-toolbelt&lt;/code&gt;&lt;/a&gt; é€™å€‹å·¥å…·ï¼Œè®“ &lt;code&gt;requests&lt;/code&gt; åœ¨ GAE Standard ä¸Šä½¿ç”¨çš„æ™‚å€™ï¼Œåº•å±¤æœƒæŠ½æ›æˆ GAE æä¾›çš„ &lt;code&gt;urlfetch&lt;/code&gt;ï¼Œé€™æ¨£æ‰èƒ½ä½¿ç”¨ï¼Œè€Œåœ¨ GAE Standard ä¸Šé è¨­å¯ä»¥ä½¿ç”¨ &lt;code&gt;urlfetch&lt;/code&gt; å’Œ &lt;code&gt;urllib2&lt;/code&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;é‚£ç‚ºä»€éº¼ä¸ç”¨ &lt;code&gt;requests&lt;/code&gt; å°±å¥½äº†ï¼Ÿå› ç‚º Legacy code çš„ç·£æ•…ï¼Œç„¡æ³•å¾ˆè¼•æ˜“ä½¿ç”¨ &lt;code&gt;requests&lt;/code&gt;ï¼Œæ‰€ä»¥æ¡ç”¨ &lt;code&gt;urllib2&lt;/code&gt;ï¼Œä½†åˆé‡åˆ°æœ‰éœ€è¦ä½¿ç”¨ Cookie çš„éœ€æ±‚ï¼Œè€Œ &lt;code&gt;urllib2&lt;/code&gt; æ˜¯æ²’æœ‰æ”¯æ´ Cookie çš„ï¼Œæ‰€ä»¥å°±å¿…é ˆå†æ­é… &lt;code&gt;cookielib&lt;/code&gt; ä¾†ä½¿ç”¨ã€‚  &lt;/p&gt;
&lt;p&gt;å°±ç”¨é€™ç¯‡æ–‡ç« ç´€éŒ„ä¸€ä¸‹ä½œæ³•ï¼Œé †ä¾¿é€£ Python 3 çš„å¯«æ³•ä¹Ÿé †ä¾¿ç´€éŒ„ä¸€ä¸‹ï¼Œå› ç‚º Python 2 è£¡çš„ &lt;code&gt;urllib2&lt;/code&gt; å’Œ &lt;code&gt;cookielib&lt;/code&gt; åœ¨ Python 3 è£¡é ­éƒ½æœ‰åšæ›´å‹•ã€‚é †ä¾¿ä¹ŸæŠŠæœ€ç°¡å–®çš„ &lt;code&gt;requests&lt;/code&gt; çš„å¯«æ³•ä¹Ÿä¸€ä½µé™„ä¸Šã€‚  &lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;Python 2: &lt;code&gt;urllib2&lt;/code&gt; + &lt;code&gt;cookielib&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Python 2 ä¸­çš„ &lt;code&gt;urllib2&lt;/code&gt; æ˜¯ &lt;code&gt;urllib&lt;/code&gt; çš„åŠ å¼·ç‰ˆï¼Œåœ¨å¯¦éš›ä½¿ç”¨ä¸Šæ¯”è¼ƒå¸¸ä½¿ç”¨ &lt;code&gt;urllib2&lt;/code&gt;ï¼Œæ‰€ä»¥é€™è£¡ç›´æ¥è¬› &lt;code&gt;urllib2&lt;/code&gt; çš„å¯«æ³•ã€‚&lt;/strong&gt;  &lt;/p&gt;
&lt;h3&gt;åŸºæœ¬ä½¿ç”¨&lt;/h3&gt;
&lt;p&gt;ç¯„ä¾‹å…¶å¯¦åœ¨å®˜æ–¹ç¶²ç«™çš„èªªæ˜æ–‡ä»¶æœ€åº•ä¸‹çš„ç¯„ä¾‹å°±æœ‰äº†ï¼š&lt;a href="https://docs.python.org/2/library/cookielib.html#examples"&gt;20.21. cookielib â€” Cookie handling for HTTP clients â€” Python 2.7.14 documentation&lt;/a&gt;ï¼Œå…¶å¯¦ä¹Ÿä¸æœƒå¾ˆè¤‡é›œã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cookielib&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nn"&gt;urllib2&lt;/span&gt;  
&lt;span class="n"&gt;cj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cookielib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CookieJar&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  
&lt;span class="n"&gt;opener&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;urllib2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;build_opener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;urllib2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;HTTPCookieProcessor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cj&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;  
&lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;opener&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;http://example.com/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;ä¸å¾æª”æ¡ˆåŒ¯å…¥ï¼Œç›´æ¥è¨­å®š Cookie&lt;/h3&gt;
&lt;p&gt;ä½†å¦‚æœä»Šå¤©æˆ‘å€‘æ²’æœ‰ä¸€ä»½å…ˆå­˜å¥½çš„ Cookie è¨­å®šæª”ï¼Œå»åˆæƒ³åœ¨ç™¼é€ request å‰é å…ˆè¨­å®šä¸€äº› Cookie çš„ value æ€éº¼è¾¦ï¼Ÿå…ˆè¬›çµè«–ï¼šã€Œæœ‰è¾¦æ³•åšåˆ°ï¼Œä½†ä¸æ¨è–¦ä½¿ç”¨ã€‚ã€ï¼ˆå¦‚æœæ˜¯è¦æ”¹ "User-Agent" çš„è©±ï¼Œé€™å€‹æ˜¯ request headerï¼Œè€Œä¸æ˜¯ cookieï¼Œæ‰€ä»¥æ˜¯ &lt;code&gt;urllib&lt;/code&gt; è¦è™•ç†ï¼Œè€Œä¸æ˜¯ &lt;code&gt;cookielib&lt;/code&gt; è™•ç†ï¼Œè«‹å‹¿ææ··ã€‚ï¼‰  &lt;/p&gt;
&lt;p&gt;&lt;code&gt;cookielib.CookieJar&lt;/code&gt; æœ‰å€‹ &lt;code&gt;set_cookie()&lt;/code&gt; çš„å‡½å¼ï¼Œå…¶é è¨­æ¥æ”¶çš„åƒæ•¸æ˜¯ &lt;code&gt;cookielib.Cookie&lt;/code&gt;ï¼Œä½† &lt;code&gt;cookielib.Cookie&lt;/code&gt; çš„æ–‡ä»¶ä¸­å»æœ‰è‘—ä»¥ä¸‹é€™æ®µèªªæ˜ï¼š  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This class represents Netscape, RFC 2109 and RFC 2965 cookies. It is not expected that users of &lt;code&gt;cookielib&lt;/code&gt; construct their own &lt;code&gt;Cookie&lt;/code&gt; instances. Instead, if necessary, call &lt;code&gt;make_cookies()&lt;/code&gt; on a &lt;code&gt;CookieJar&lt;/code&gt; instance.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯èªªï¼Œé è¨­å…¶å¯¦æ˜¯ä¸æœŸæœ›ä½¿ç”¨è€…è‡ªå·±è¨­å®š Cookie çš„ï¼Œä½†ä¸¦ä¸æ˜¯ä¸èƒ½åšåˆ°ï¼Œé€™å€‹åœ¨ StackOverflow ä¸Šçš„å›ç­”æœ‰çµ¦å‡ºç¯„ä¾‹ï¼š&lt;a href="https://stackoverflow.com/questions/4685337/python-add-cookie-to-cookiejar#12682437"&gt;python - add cookie to cookiejar - Stack Overflow&lt;/a&gt;ï¼Œä½†æˆ‘è‡ªå·±æ˜¯è¦ºå¾—éå¸¸çš„ä¸ç›´è§€ï¼Œç”¨é€™ç¨®é–‹ç™¼æ–¹å¼æ‡‰è©²å¾ˆé›£ç¶­è­·ï¼Œé™¤éåˆå§‹åŒ– &lt;code&gt;cookielib.Cookie&lt;/code&gt; çš„æ™‚å€™æŠŠåƒæ•¸çš„ key éƒ½åŠ ä¸Šå»ã€‚é †å¾…ä¸€æï¼Œé€™ç¯‡æ–‡ç« çš„æå•è€…èª¤æŠŠ &lt;code&gt;Cookie.SimpleCooke&lt;/code&gt; ä¸Ÿçµ¦ &lt;code&gt;cookielib.CookieJar.set_cookie()&lt;/code&gt; ç•¶åƒæ•¸é¤µå…¥ï¼Œä½†é€™å€‹å‡½å¼å¯ä»¥æ¥å—çš„åƒæ•¸å¿…é ˆæ˜¯ &lt;code&gt;cookielib.Cookie&lt;/code&gt;ï¼Œè€Œä¸æ˜¯ &lt;code&gt;Cookie.SimpleCookie&lt;/code&gt;ï¼Œæ‰€ä»¥å‡ºäº†éŒ¯ï¼Œè€Œä¸”é€™å…©è€…ä¸¦æ²’æœ‰ä»»ä½•é—œä¿‚ï¼Œå®Œå…¨æ˜¯ç¹¼æ‰¿è‡ªä¸åŒçš„ classã€‚  &lt;/p&gt;
&lt;h3&gt;å¾æª”æ¡ˆåŒ¯å…¥/åŒ¯å‡ºåˆ°æª”æ¡ˆ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/2/library/cookielib.html#cookielib.FileCookieJar.save"&gt;&lt;code&gt;cookielib.FileCookieJar.save&lt;/code&gt;&lt;/a&gt;  &lt;ul&gt;
&lt;li&gt;å°‡ç¾æœ‰çš„ Cookie export åˆ°æª”æ¡ˆä¸­ã€‚  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/2/library/cookielib.html#cookielib.FileCookieJar.load"&gt;&lt;code&gt;cookielib.FileCookieJar.load&lt;/code&gt;&lt;/a&gt;  &lt;ul&gt;
&lt;li&gt;å¾æª”æ¡ˆä¸­ import Cookie çš„è¨­å®šé€²ä¾†ã€‚  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™æ¨£ä¸€ä¾†åœ¨å¯¦ä½œçˆ¬èŸ²æ™‚ï¼Œé‡åˆ°æœƒåˆ©ç”¨ Cookie ä¾†åˆ¤æ–·ä½¿ç”¨è€…æ˜¯å¦ç™»å…¥çš„ç¶²ç«™æ™‚å°±å¾ˆæ–¹ä¾¿ã€‚  &lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;Python 3: &lt;code&gt;urllib.request&lt;/code&gt; + &lt;code&gt;http.cookiejar&lt;/code&gt;&lt;/h2&gt;
&lt;h3&gt;åŸºæœ¬ä½¿ç”¨&lt;/h3&gt;
&lt;p&gt;ä¸€æ¨£åœ¨ Python å®˜æ–¹çš„èªªæ˜æ–‡ä»¶åº•ä¸‹å°±æœ‰ç¯„ä¾‹å¯ä»¥åƒè€ƒäº†ï¼š&lt;a href="https://docs.python.org/3/library/http.cookiejar.html?highlight=cookiejar#examples"&gt;21.24. http.cookiejar â€” Cookie handling for HTTP clients â€” Python 3.6.4 documentation&lt;/a&gt;  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;http.cookiejar&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nn"&gt;urllib.request&lt;/span&gt;  
&lt;span class="n"&gt;cj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cookiejar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CookieJar&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  
&lt;span class="n"&gt;opener&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;urllib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;build_opener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;urllib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;HTTPCookieProcessor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cj&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;  
&lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;opener&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;http://example.com/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å…¶å¯¦å¯ä»¥çœ‹åˆ°è·Ÿ Python 2 çš„å¯«æ³•ä¸€æ¨¡ä¸€æ¨£ï¼Œåªæ˜¯æŠŠ &lt;code&gt;cookielib&lt;/code&gt; æ›æˆ &lt;code&gt;http.cookiejar&lt;/code&gt;ï¼Œ&lt;code&gt;urllib2&lt;/code&gt; æ›æˆ &lt;code&gt;urllib.request&lt;/code&gt; è€Œå·²ã€‚  &lt;/p&gt;
&lt;h3&gt;ä¸å¾æª”æ¡ˆåŒ¯å…¥ï¼Œç›´æ¥è¨­å®š Cookieã€‚&lt;/h3&gt;
&lt;p&gt;é€™éƒ¨ä»½è·Ÿ Python 2 ä¸€æ¨£ï¼Œå¯ä»¥åšåˆ°ï¼Œä½†ä¸æ¨è–¦ï¼Œå°±ä¸è´…è¿°ã€‚  &lt;/p&gt;
&lt;h3&gt;å¾æª”æ¡ˆåŒ¯å…¥/åŒ¯å‡ºåˆ°æª”æ¡ˆ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/3/library/http.cookiejar.html?highlight=cookiejar#http.cookiejar.FileCookieJar.save"&gt;&lt;code&gt;http.cookiejar.FileCookieJar.save&lt;/code&gt;&lt;/a&gt;  &lt;ul&gt;
&lt;li&gt;å°‡ç›®å‰çš„ Cookie åŒ¯å‡ºåˆ°æª”æ¡ˆã€‚  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/3/library/http.cookiejar.html?highlight=cookiejar#http.cookiejar.FileCookieJar.load"&gt;&lt;code&gt;http.cookiejar.FileCookieJar.load&lt;/code&gt;&lt;/a&gt;  &lt;ul&gt;
&lt;li&gt;å¾ç¾æœ‰çš„æª”æ¡ˆä¸­åŒ¯å…¥ Cookieã€‚  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2&gt;requests&lt;/h2&gt;
&lt;p&gt;å®˜æ–¹æ–‡ä»¶çš„ Quickstart å°±æœ‰ä¸€å€‹é—œæ–¼ Cookies çš„éƒ¨ä»½ï¼š&lt;a href="http://docs.python-requests.org/en/master/user/quickstart/#cookies"&gt;Quickstart â€” Requests 2.18.4 documentation&lt;/a&gt;  &lt;/p&gt;
&lt;p&gt;&lt;code&gt;requests&lt;/code&gt; æœ¬èº«å°±è‡ªå¸¶ Cookie çš„è™•ç†äº†ï¼Œç”¨æ³•ç°¡å–®äº†è¨±å¤šï¼š  &lt;/p&gt;
&lt;h3&gt;åŸºæœ¬ä½¿ç”¨&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;If a response contains some Cookies, you can quickly access them:  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://example.com/some/cookie/setting/url&amp;#39;&lt;/span&gt;  
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;example_cookie_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;  
&lt;span class="s1"&gt;&amp;#39;example_cookie_value&amp;#39;&lt;/span&gt;  
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;To send your own cookies to the server, you can use the cookies parameter:  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://httpbin.org/cookies&amp;#39;&lt;/span&gt;  
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cookies_are&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;working&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  

&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;  
&lt;span class="s1"&gt;&amp;#39;{&amp;quot;cookies&amp;quot;: {&amp;quot;cookies_are&amp;quot;: &amp;quot;working&amp;quot;}}&amp;#39;&lt;/span&gt;  
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;ä¸å¾æª”æ¡ˆåŒ¯å…¥ï¼Œç›´æ¥è¨­å®š Cookieã€‚&lt;/h3&gt;
&lt;p&gt;åŸºæœ¬ä¸Šé€™é‚Šçš„ä½œæ³•å°±æ˜¯ä¸Šé¢ Python 2 é‚£é‚Šæåˆ°çš„ä½œæ³•ï¼Œä¸é &lt;code&gt;requests&lt;/code&gt; æŠŠå‰›å‰›èªªçš„åŠ ä¸Šåƒæ•¸ key  é€™ä»¶äº‹æƒ…ç¨å¾®è™•ç†äº†ä¸€ä¸‹ã€‚  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Cookies are returned in a &lt;code&gt;RequestsCookieJar&lt;/code&gt;, which acts like a &lt;code&gt;dict&lt;/code&gt; but also offers a more complete interface, suitable for use over multiple domains or paths. Cookie jars can also be passed in to requests:  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RequestsCookieJar&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;jar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tasty_cookie&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;yum&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;httpbin.org&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/cookies&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;jar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gross_cookie&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;blech&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;httpbin.org&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/elsewhere&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://httpbin.org/cookies&amp;#39;&lt;/span&gt;  
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;jar&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;  
&lt;span class="s1"&gt;&amp;#39;{&amp;quot;cookies&amp;quot;: {&amp;quot;tasty_cookie&amp;quot;: &amp;quot;yum&amp;quot;}}&amp;#39;&lt;/span&gt;  
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;å¾æª”æ¡ˆåŒ¯å…¥/åŒ¯å‡ºåˆ°æª”æ¡ˆ&lt;/h3&gt;
&lt;p&gt;é€™éƒ¨ä»½åœ¨ &lt;code&gt;requests&lt;/code&gt; å°±æ¯”è¼ƒéº»ç…©ä¸€é»ï¼Œä½†ä¹Ÿä¸é›£ï¼Œéœ€è¦é¡å¤–ç”¨åˆ° &lt;code&gt;requests.utils.dict_from_cookiejar()&lt;/code&gt;ï¼Œè©³ç´°å¯ä»¥åƒè€ƒé€™ç¯‡ StackOverflow çš„è§£ç­”ï¼š&lt;a href="https://stackoverflow.com/questions/13030095/how-to-save-requests-python-cookies-to-a-file/13031628#13031628"&gt;How to save requests (python) cookies to a file? - Stack Overflow&lt;/a&gt;ï¼Œå®ƒé‚„æœ‰ç”¨åˆ° &lt;code&gt;pickle&lt;/code&gt; é€™å€‹å‡½å¼åº«ã€‚  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç„¡è«–æ˜¯ &lt;code&gt;requests.Response.cookies&lt;/code&gt; æˆ– &lt;code&gt;requests.Sessions.Session.cookies&lt;/code&gt; éƒ½æ˜¯ &lt;code&gt;requests.cookies.cookiejar_from_dict()&lt;/code&gt; çš„è¼¸å‡ºçµæœã€‚  &lt;/li&gt;
&lt;li&gt;å¯ä»¥ç”¨ &lt;code&gt;requests.utils.dict_from_cookiejar()&lt;/code&gt; é€™å€‹å‡½å¼ï¼Œå°‡ &lt;code&gt;response.cookies&lt;/code&gt; æˆ–æ˜¯ &lt;code&gt;session.cookies&lt;/code&gt; ç•¶ä½œè¼¸å…¥ï¼Œå°±å¯ä»¥å¾—åˆ°è©² Cookie ä»¥ &lt;code&gt;dict&lt;/code&gt; æ–¹å¼å‘ˆç¾çµæœï¼Œç•¶ç„¶ä¹Ÿå°±å¯ä»¥åŒ¯å‡ºåˆ°æª”æ¡ˆã€‚  &lt;/li&gt;
&lt;li&gt;è¦åŒ¯å…¥çš„è©±ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;requests.utils.cookiejar_from_dict()&lt;/code&gt; é€™å€‹åƒæ•¸ä¾†æŠŠ &lt;code&gt;dict&lt;/code&gt; è½‰æˆ &lt;code&gt;RequestsCookieJar&lt;/code&gt;ã€‚  &lt;ul&gt;
&lt;li&gt;&lt;code&gt;requests.utils.cookiejar_from_dict()&lt;/code&gt; æ˜¯å¾ &lt;code&gt;requests.cookies&lt;/code&gt; import ä¾†çš„ã€‚  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨åˆ° &lt;code&gt;pickle&lt;/code&gt; åªæ˜¯æ–¹ä¾¿ä»¥ &lt;code&gt;pickle&lt;/code&gt; çš„å½¢å¼å„²å­˜è€Œå·²ã€‚  &lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2&gt;çµè«–&lt;/h2&gt;
&lt;p&gt;èƒ½ç”¨ &lt;code&gt;requests&lt;/code&gt; çš„è©±ç•¶ç„¶å°±ç›´æ¥ç”¨å§ï¼Œå¦‚æœé‡åˆ°æˆ‘æåˆ°çš„é€™ç¨®ç‹€æ³æ‰æœƒéœ€è¦ç‰¹æ®Šçš„è§£æ³•ã€‚  &lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;åƒè€ƒä¾†æº&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://stackoverflow.com/questions/2018026/what-are-the-differences-between-the-urllib-urllib2-and-requests-module"&gt;python - What are the differences between the urllib, urllib2, and requests module? - Stack Overflow&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/requests/requests"&gt;GitHub - requests/requests: Python HTTP Requests for Humansâ„¢ âœ¨ğŸ°âœ¨&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/requests/toolbelt"&gt;GitHub - requests/toolbelt: A toolbelt of useful classes and functions to be used with python-requests&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/2.7/library/urllib.html?highlight=urllib"&gt;20.5. urllib â€” Open arbitrary resources by URL â€” Python 2.7.14 documentation&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/2.7/library/urllib2.html"&gt;20.6. urllib2 â€” extensible library for opening URLs â€” Python 2.7.14 documentation&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/2/library/cookielib.html"&gt;20.21. cookielib â€” Cookie handling for HTTP clients â€” Python 2.7.14 documentation&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/3/library/urllib.html?highlight=urllib"&gt;21.5. urllib â€” URL handling modules â€” Python 3.6.4 documentation&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/3/library/http.cookiejar.html?highlight=cookiejar#module-http.cookiejar"&gt;21.24. http.cookiejar â€” Cookie handling for HTTP clients â€” Python 3.6.4 documentation&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="http://docs.python-requests.org/en/master/user/quickstart/#cookies"&gt;Quickstart â€” Requests 2.18.4 documentation&lt;/a&gt;  &lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">m157q</dc:creator><pubDate>Sun, 07 Jan 2018 01:42:00 +0800</pubDate><guid isPermaLink="false">tag:blog.m157q.tw,2018-01-06:posts/2018/01/06/use-cookie-with-urllib-in-python/</guid><category>Python</category><category>Python 2</category><category>Python 3</category><category>urllib</category><category>cookie</category><category>requests</category><category>2018 iT é‚¦å¹«å¿™éµäººè³½</category></item></channel></rss>