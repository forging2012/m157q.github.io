<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Just for noting</title><link href="https://blog.m157q.tw/" rel="alternate"></link><link href="https://blog.m157q.tw/feeds/tag.awsugtw.atom.xml" rel="self"></link><id>https://blog.m157q.tw/</id><updated>2016-04-20T00:03:00+08:00</updated><entry><title>AWSUGTW Meetup 10th Note</title><link href="https://blog.m157q.tw/posts/2016/04/19/awsugtw-meetup-10th-note/" rel="alternate"></link><published>2016-04-20T00:03:00+08:00</published><updated>2016-04-20T00:03:00+08:00</updated><author><name>m157q</name></author><id>tag:blog.m157q.tw,2016-04-19:posts/2016/04/19/awsugtw-meetup-10th-note/</id><summary type="html">&lt;p&gt;&lt;a href="http://awsugtw.kktix.cc/events/10-tpe"&gt;http://awsugtw.kktix.cc/events/10-tpe&lt;/a&gt;  &lt;/p&gt;
&lt;hr /&gt;
&lt;h1&gt;Best practices for AWS ECS and Serverless&lt;/h1&gt;
&lt;h2&gt;Speaker: Pahud&lt;/h2&gt;
&lt;h3&gt;AWS EC2 Container Service (ECS)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ECS Cluster  &lt;ul&gt;
&lt;li&gt;ASG (Auto Scaling Group)  &lt;ul&gt;
&lt;li&gt;on-demand  &lt;/li&gt;
&lt;li&gt;spot instance (85% off compare to on demand ASG)  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;CloudWatch  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Auto Scaling Policy Design  &lt;ul&gt;
&lt;li&gt;&lt;code&gt;30%-60%&lt;/code&gt;: scale out spot  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;gt;= 60%&lt;/code&gt;: scale out on-demand  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;below 30%&lt;/code&gt;: scale in spot  &lt;/li&gt;
&lt;li&gt;Simple tip  &lt;ul&gt;
&lt;li&gt;on-demand 打底，spot 伸縮。  &lt;/li&gt;
&lt;li&gt;spot fleet if you need couples of instances (for RTB)  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://aws.amazon.com/sqs/"&gt;SQS (Job queue)&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://aws.amazon.com/elasticloadbalancing/"&gt;internal / external ELB&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/QuickStartEC2Instance.html"&gt;CloudWatch Logs Agent&lt;/a&gt;  &lt;ul&gt;
&lt;li&gt;Chat Ops  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://aws.amazon.com/ecr/"&gt;ECR - EC2 Container Registry&lt;/a&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;a href="http://www.slideshare.net/JulienSIMON5/amazon-ecs-january-2016/12"&gt;Load Balancing on Random Ports&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Meteor Galaxy  &lt;ul&gt;
&lt;li&gt;session-aware with random ports  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Is there a way to move code in cloud native way?&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;"No server is easier to manage than no server."  &lt;/li&gt;
&lt;li&gt;Event-driven Cloud Computing  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html"&gt;AWS Lambda&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://aws.amazon.com/api-gateway/"&gt;AWS API Gateway&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://aws.amazon.com/kinesis/streams/"&gt;Amazon Kinesis&lt;/a&gt;  &lt;ul&gt;
&lt;li&gt;persistent  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://aws.amazon.com/dynamodb/"&gt;DynamoDB&lt;/a&gt;  &lt;ul&gt;
&lt;li&gt;可以搭配 AWS Lambda 使用，幫忙 Archive  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://aws.amazon.com/cloudtrail/"&gt;AWS CloudTrail&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href="https://aws.amazon.com/sns/"&gt;AWS SNS&lt;/a&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Mobile Integration&lt;/h3&gt;
&lt;p&gt;手機安裝 SDK，可以直接使用 AWS Lambda&lt;br /&gt;
支援 RequestResponse(Sync), Event(Async)&lt;br /&gt;
可以直接丟 json payload  &lt;/p&gt;
&lt;p&gt;如果不要直接跟 AWS Lambda 互動的話&lt;br /&gt;
可以透過 API Gateway 使用 HTTPS RESTful API  &lt;/p&gt;
&lt;p&gt;可以使用 Service Proxy Integration&lt;br /&gt;
透過 IAM assume role 去達成  &lt;/p&gt;
&lt;h3&gt;API Gateway Call Flow&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;User =&amp;gt;  
Internet =&amp;gt;  
Amazon CloudFront (保證最佳 routing) =&amp;gt;  
API Gateway =&amp;gt; API Gateway Cache  
            =&amp;gt; Amazon CloudWatch Monitoring  
            =&amp;gt; Endpoints on Amazon EC2  
            =&amp;gt; Any other accessible pubilc data.  
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Pros and Cons&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Pros  &lt;ul&gt;
&lt;li&gt;cloud native with you business code in AWS Lambda  &lt;/li&gt;
&lt;li&gt;不需要維護 infra  &lt;/li&gt;
&lt;li&gt;leverage AWS PaaS infrastructure at scale  &lt;/li&gt;
&lt;li&gt;custom or federated authorization  &lt;ul&gt;
&lt;li&gt;接到 request 後，可以先丟到某個 AWS Lambda 作 Authorization 當作 Authorization module  &lt;/li&gt;
&lt;li&gt;或是 AWS Lamdba 轉到預先寫好的或已經存在的認証系統請求 Authorization  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;very minimal cost for small-medium teams  &lt;ul&gt;
&lt;li&gt;AWS Lambda: 30M requests $11.53  &lt;/li&gt;
&lt;li&gt;AWS API Gateway: 1M requests $4.23  &lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.slideshare.net/CaseyLee2/serverless-delivery"&gt;http://www.slideshare.net/CaseyLee2/serverless-delivery&lt;/a&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cons - Lambda Limit  &lt;ul&gt;
&lt;li&gt;Lambda soft limit concurrency is 100  &lt;ul&gt;
&lt;li&gt;調高的話必須要申請，預設是只有 100，為了防止你不小心寫錯程式導致帳單爆表 (?)  &lt;/li&gt;
&lt;li&gt;300 seconds max duration per invocation  &lt;/li&gt;
&lt;li&gt;Lambda in VPC restriction  &lt;ul&gt;
&lt;li&gt;Private IP addresses  &lt;/li&gt;
&lt;li&gt;ENIC limit (default 20*5 == 100)  &lt;ul&gt;
&lt;li&gt;會用掉一張虛擬網卡  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cons - API Gateway is Expensive  &lt;ul&gt;
&lt;li&gt;500-1000 QPS per AWS Account  &lt;/li&gt;
&lt;li&gt;5M requests/month == $18.79  &lt;/li&gt;
&lt;li&gt;100 QPS == $974.07/month == 31,350 NTD  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cons - Performance  &lt;ul&gt;
&lt;li&gt;push and pull invocation model of Lambda  &lt;/li&gt;
&lt;li&gt;-&amp;gt; delegation with higher memory  &lt;ul&gt;
&lt;li&gt;用一個專門的 AWS Lambda，只從 stream 抓東西出來，丟給別的 AWS Lambda 做邏輯處理。  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;No connection pooling  &lt;ul&gt;
&lt;li&gt;Container 只有在第一次啟動的時候會 loading 最一開始初始化的部份  &lt;/li&gt;
&lt;li&gt;之後被 reuse 的時候會直接進 handler  &lt;/li&gt;
&lt;li&gt;所以不要把 conneciton 放在 code 一開始的部份，否則很可能會常常看到 conneciton 沒有正常 close，造成 TCP overhead.  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cons - Development  &lt;ul&gt;
&lt;li&gt;CloudWatch debugging is slow.  &lt;/li&gt;
&lt;li&gt;Immature CI/CD toolchains  &lt;/li&gt;
&lt;li&gt;lack of PHP, Ruby and Golang  &lt;/li&gt;
&lt;li&gt;re-deploy the whole bundle could be a pain.  &lt;ul&gt;
&lt;li&gt;萬一 bundle 的大小超過 20~30 MB 的話有個解法  &lt;ul&gt;
&lt;li&gt;把 bundle 丟到 S3 裡面後，寫支 AWS Lamdba 幫你把這包 bundle 丟到另外一個 AWS Lambda 做處理  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;When should I use ECS and when for Serverless?&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;When to use ECS  &lt;ul&gt;
&lt;li&gt;Financial concern - When you have traffic more than 100+ QPS  &lt;/li&gt;
&lt;li&gt;Operation concern - Long running process or API service  &lt;/li&gt;
&lt;li&gt;Language concern - Golang, PHP, Ruby, etc.  &lt;/li&gt;
&lt;li&gt;Performance concern  &lt;/li&gt;
&lt;li&gt;Protocol concern  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;When to use Serverless  &lt;ul&gt;
&lt;li&gt;Small project, simple business logic  &lt;/li&gt;
&lt;li&gt;focus on the code only  &lt;/li&gt;
&lt;li&gt;no infra management  &lt;/li&gt;
&lt;li&gt;stateless  &lt;/li&gt;
&lt;li&gt;quick micro services implementation  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Conclusions&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;儘可能把服務 container 化  &lt;/li&gt;
&lt;li&gt;Build stateless application  &lt;/li&gt;
&lt;li&gt;Immutable architecture  &lt;ul&gt;
&lt;li&gt;every computing conponent can be replaced and scaled with no impact  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Focus on your business logic, instead of the infra, forget your infra  &lt;/li&gt;
&lt;li&gt;Try not use any EC2, if necessary, avoid SSH into EC2 for manual operation.  &lt;ul&gt;
&lt;li&gt;不要想要救任何一台機器，應該要儘可能做到 stateless，只要壞掉就抽換掉。  &lt;/li&gt;
&lt;li&gt;抱著這樣的想法，比較能夠設計出夠彈性化的架構。  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Fully-managed and fully-automation is the way to go.  &lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h1&gt;Interview Quiz w/o Servers&lt;/h1&gt;
&lt;h2&gt;Speaker: Cliff Lu&lt;/h2&gt;
&lt;h3&gt;用 AWS 架設低成本的面試系統&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Interview Automation  &lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.bnext.com.tw/ext_rss/view/id/1099271"&gt;超過 90 秒的都要自動化！&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;考量  &lt;ul&gt;
&lt;li&gt;效能  &lt;/li&gt;
&lt;li&gt;管理  &lt;/li&gt;
&lt;li&gt;費用  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;AWS API Gateway + Lambda + S3  &lt;/li&gt;
&lt;li&gt;AWS Lambda  &lt;ul&gt;
&lt;li&gt;Serverless computing service  &lt;ul&gt;
&lt;li&gt;Support Python, Node.js, Java  &lt;ul&gt;
&lt;li&gt;Python 在上面沒有 share memory 可用，所以 multiprocess library 無效，得用 os.fork。  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Managed, AWS 負責 HA and Scalability  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/tmp&lt;/code&gt; 有 512MB 可用  &lt;/li&gt;
&lt;li&gt;若 24/7 運行 (128MB)，費用與 t2.nano 差不多  &lt;/li&gt;
&lt;li&gt;觸發與權限設置詳見文件  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;AWS API Gateway  &lt;ul&gt;
&lt;li&gt;Managed HTTPS API Gateway  &lt;/li&gt;
&lt;li&gt;權限設計頗複雜，說明文件寫的蠻糟的，必須詳讀文件。  &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h1&gt;心得&lt;/h1&gt;
&lt;p&gt;第一次參加 AWS 的聚會，也算是第一次認真接觸 AWS 啦。&lt;br /&gt;
畢竟之前也就只有在參加 Conf 還有一些閒聊的時候聽到些名詞。&lt;br /&gt;
只有懵懵懂懂的瞭解，印象最深的就是 AWS 有一堆自創的 service name，讓我不是很喜歡。&lt;br /&gt;
雖然公司目前都在用 GCP ，但還是會想瞭解一下 AWS 的內容。&lt;br /&gt;
希望之後對 GCP 和 AWS 都足夠瞭解之後，&lt;br /&gt;
可以有辦法自己歸納瞭解 GCP 和 AWS 之間的優缺點，&lt;br /&gt;
無論是在 Performance, Scalability, Pricing, Flexibility 等等。&lt;br /&gt;
畢竟如果要朝 Architect 走的話我想這是不可少的。&lt;br /&gt;
如果能力足夠的話可能還會再看看 Azure 吧。&lt;br /&gt;
不過目前看來應該還是會以 GCP 為主&lt;br /&gt;
希望之後研究夠深入的話可以有機會成為 GCP 相關 Library 的 contributor，&lt;br /&gt;
只是當個 User 的話實在是有點無趣。  &lt;/p&gt;
&lt;p&gt;話說 AWSUGTW 感覺蠻用心在經營的，&lt;br /&gt;
挑的 CLBC 夠寬敞（跟我常去 Taipei.py 用的那個 CLBC 差好多 QQ），&lt;br /&gt;
備有額外的茶點，而且免場地費。（真好奇錢從哪來的 XD)&lt;br /&gt;
還會請參加者填寫問卷收集回饋意見。&lt;br /&gt;
跟我最近參加過的 Taipei.py 跟 GCPUGTW 比起來算是比較會讓新加入者比較想繼續來的那種。&lt;br /&gt;
（而且女生好多，Taipei.py 只有一點點，GCPUGTW 完全沒有 XDDD）&lt;br /&gt;
不過沒啥人問問題，讓我不知道參加者到底是有沒有聽懂，&lt;br /&gt;
不過會後感覺蠻多人私底下去找講者討論的，應該只是不想或不敢當面問吧？&lt;br /&gt;
然後沒看到平常跑社群的熟面孔，&lt;br /&gt;
果然不同的 User Group 就是不同的生態圈啊。  &lt;/p&gt;</summary><category term="AWS"></category><category term="AWSUGTW"></category><category term="EC2"></category><category term="Serverless"></category><category term="Meetup"></category></entry></feed>